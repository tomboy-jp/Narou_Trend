# なろうトレンド
「小説家になろう」様でウケている小説のトレンドを探ります。

## 標本取得条件の定義
まずは今回の調査の目的からどういった基準で標本データを取得するのかを定義する必要があります。  

目的はトレンドの調査ですので、なるべく最近始まった作品を対象とすべきですが、とはいえあまりに直近のものですと、評価が追いついていなかったり、あるいは文量が少なすぎて、小説として評価出来ない状態である、といったリスクが生じます。  
この辺りは本当にさじ加減一つなのですがひとまずは、

- 2018年01月01日〜2018年05月31日の間に初稿が投稿されていること
- 作品の総文量が5000文字以上であること  

以上の条件を採用します。  

また統計量についてですが、  
なるべく多くの標本を取りたかったものの、試しにクローラーを走らせてみたところ、
上記の条件を満たしつつ、エタ(エターナルの略、作品の更新が途絶えてしまっている状態)っていない作品が思いのほか少なかったため、  

- 統計量は2000件

とさせて頂きました。  
他に良いクローラーの走らせ方が見つかったらここは見直すかもしれません。  

## 評価基準の定義
回帰を行う上で評価値は必ず数値化する必要があります。  
幸いなろう様の場合はポイントという明確な基準が用意されていますので、これをそのまま転用することにします。  

これと本文を結びつけて傾向を出すわけですが、全文を対象すると作品ごとの文量に左右されることになり、正しく評価することができません。  
賛否両論あるかとは思いますが、「小説において最も重要な箇所は導入部分である」との仮説のもと、  

- 最初の2000字を評価基準とする

とさせて頂きます。  

あらすじの内容、更新頻度、文量といったセグメントがポイントと強い相関関係にあることは周知の通りですが、  
標本抽出の時点で一定上の更新頻度と文量は担保していますし、導入部分とあらすじは執筆テクニック論といった視点で見ると非常に多くの共通事項を有しています。  
ゆえに「導入部分が優れていればあらすじも優れている傾向にある」との仮説に立ち、導入部分だけに絞って解析していきます。

## データの取得
```
$ python scrawling.py  
```
robots.txtによるとなろう様では3秒に1アクセスまでなら許可されているとのことですので、その通りに設定します。  
2000件の取得後(更新ページをぐるぐる回っていたら丸2日かかりました)、ひとまずポイントの分布見てみます。  
```
$ python hist_maker.py
```
横軸がポイントを、縦軸が作品数を示しています。  

![分布図](https://raw.githubusercontent.com/tomboy-jp/Narou_Trend/master/result/point_graph.png "実行結果")

見事なまでのべき乗分布です。  
この場合、グラフだと逆に分かりにくいので、数字を見ていきましょう。  
左のカラムがポイントで右のカラムが作品数です。  

```
$ head -n 25 result/point_dist.csv

0,220
2,169
4,80
5,2
6,65
7,2
8,45
9,8
10,39
11,10
12,51
13,5
14,45
15,4
16,42
17,3
18,21
19,4
20,39
21,6
22,26
23,3
24,16
25,6
26,27

$ tail -n 25 result/point_dist.csv

26553,1
26666,1
26874,1
27696,1
28510,1
28979,1
29195,1
29263,1
31952,1
32156,1
35175,1
35334,1
36368,1
37227,1
37329,1
40197,1
40496,1
43782,1
46421,1
47864,1
48581,1
50506,1
70541,1
77606,1
93176,1
```

思いのほか0ポイントが少なくて安心しました。
上位層にかなり引っ張られそうではありますが、これなら一応傾向値を出せそうです。

## 自然言語処理と回帰分析  
```
python exe_ml.py
```
ここから先はセオリー通りにMeCabとtf-idfベクトライザを使って自然言語処理をしてデータを作成し、グリッドサーチで適切なパラメータを探っていきます。  

使用する学習モデルですが、今回はRidge回帰を使用しました。  
トレンドを探る、つまりどんな単語が効いているのかをリスト化するのが目的ですので、中身がブラックボックス化するディープ系はアウトですし、同じ理由で結果の一部が埋もれてしまうL1正規化に抵抗があるためです。  

結果、以下のようなモデルが出来上がりました。

```
Mean Absolute Error: 1588.029
Best Parameters:
{'ridge__alpha': 10, 'ridge__fit_intercept': False, 'ridge__normalize': True, 'ridge__random_state': 0}
```

一行目は「+-1588ポイントくらいのブレ幅で精度が保証されています」という意味で、  
二行目以降にグリッドサーチの結果、最適とされたパラメータが記載されています。  
なかなかのバラつきですが、未来予測に使うならともかく、傾向調査ならこれで充分でしょう。  

## 結果を表示
```
$ python weight_of_words.py
```
ではお待ちかね。  
結果を見てみましょう。
```
$ head -n 100 result/coefficients.csv

アレン,3694.611670772709
フラム,3391.0338506838493
ロイ,2992.483782755594
勇者,2966.1188691962975
ルナ,2601.258513776325
三世,2575.906297733824
ランク,2549.05180541881
ハンター,2472.070671834791
冒険者,2437.6545598369407
眼,2043.61797200912
し,2037.5859508740132
出来損ない,2024.1447784944198
パーティー,1991.721648029425
sss ランク,1970.0588741131244
シオン,1958.5926701258375
琥珀,1869.237441646623
sss,1834.7253700811743
父上,1727.5144704756708
ハル,1575.4279887031685
キミ,1532.433331441164
魔王,1486.027913730961
婚約,1439.3479901403277
ー,1438.3459662281055
パーティ,1369.564372091581
アベル,1347.12913322945
の,1325.7669082919426
天使,1276.3807014603651
前世,1266.940501613351
人生,1236.3029602403099
い,1207.684247991422
金貨,1190.5733384948564
アリシア,1189.1524232554225
聖水,1125.7087188023327
この,1119.9674698243846
城,1115.3237257133756
結婚,1079.3985143995408
レベル,1018.741274113617
色 眼,1010.4034104054219
レベル 3,1007.434150876359
人間,998.5394602191107
隣国,982.1242299871636
ギルド,980.007369755421
気配 遮断,977.2688591674001
記憶,976.9240523128398
れ,957.9724045618243
平和 なっ,914.9392093226991
リタ,914.1943885183312
ダンジョン,908.5404781731671
魔術,904.5538979501545
魔法,900.5337131246959
アレク,900.4709325755828
孤島,895.3380393517767
もう,883.9509433921044
薬草,872.4189496761092
剣,870.8961296981144
魔,854.2308512537983
段階,839.5096254372213
許嫁,823.4883170585781
三人,813.373012724746
教会,800.9730754773237
記憶 消去,786.9303555245207
この 世界,776.2258064394456
赤ん坊,760.5320093913106
なっ 世界,756.9138513785226
仕事,756.2814455046224
突き落とさ れ,748.9900332001597
魔獣,744.4714294722017
仮面,742.9927884700771
父,739.8896016931778
取得,731.0892989369313
妹,726.4026887911583
スキャン,725.058959950637
スライム,723.589209922452
いい,723.0005806022536
遮断,721.6473069467178
突き落とさ,718.0459336356153
適性,716.8459758948636
世界,715.9495506209543
王国,715.1112485926234
初期 設定,712.1663890357972
魔力,711.2219567806702
vr 機器,706.9268574779065
プライド,700.4913076359018
する,696.187831255947
王女,693.8709995571855
善行,688.1644548661399
メンバー,684.3325594846795
この パーティー,673.3716805772135
眼 色,670.5553791767038
インストール,665.2119512188124
前世 記憶,663.4979045994131
消去,662.965105397296
出現,662.5217493444678
顔,657.6959677796443
持っ,653.5538230569404
魔術師,651.1865392439836
ゲーム,644.838153930861
婚約破棄,641.5587200132917
王様,639.4019373765166

$ tail -n 100 result/coefficients.csv

神,-203.56947400525843
ジョブ,-204.89814420680142
周り,-207.8922525434582
高校,-208.0142010927612
魔法陣,-208.6664475622184
しまい,-208.85826712552162
言っ て,-209.06581550404943
光景,-209.5500717199447
連れ,-209.71735611958732
案内,-210.12704893761588
適当,-210.3540661359865
わし,-211.58086513932466
肉,-213.30413709756218
裏,-213.89413776802584
白,-214.81768587110005
二人,-215.47406800949153
普通,-216.34373195135154
状態,-216.40190700903767
音,-216.61031775985109
訳,-219.76487716774662
生命,-220.63335619749313
会話,-220.9608403755727
訓練,-221.73308231187454
レイ,-223.3279298492446
モノ,-225.17073330469995
とりあえず,-225.51901799334027
サラ,-226.25781799886352
君,-226.31315275417177
刀,-228.10744323586863
手紙,-230.7693631570604
書い,-230.98935942525233
コンビニ,-232.50692516132955
おかしい,-233.84686712490287
来る,-234.68419353666886
姉,-234.8972225537671
テンプレ,-235.62628207114818
姿,-236.37067380016356
感情,-239.97393739125255
思い,-242.22395913849564
大きく,-246.36499684930823
竜,-249.77404430430917
聞こえ,-249.7859324396529
見え,-251.16461649641886
夢,-252.12792064863984
言っ,-255.3856926411517
黒,-257.34682299635386
思う,-258.94185266023277
倒れ,-263.6649186595243
友達,-263.789375790279
銃,-264.39941671467534
使い,-267.0001735832357
右手,-267.512296453225
居,-269.74689434057285
物語,-271.5636152920634
エルフ,-272.98434706717615
小説,-273.3588060723595
声 聞こえ,-273.4965513674493
お兄ちゃん,-274.70928747512886
魔女,-275.24484816098817
少年,-276.3938686034357
人形,-277.88887940850674
馬,-283.7370582254678
ぼく,-284.28788964862616
無い,-285.76694025153824
人類,-287.0075915909852
族,-287.5219988566545
し いる,-291.02454588380925
アニメ,-293.5491873462385
目的,-293.6751819447144
車,-295.2228543859937
主,-298.08372008876415
質問,-300.4934081043198
女の子,-305.34985004877524
兄,-308.3742492924658
いきなり,-310.61602095624244
逃げ,-316.30239407192033
朝,-321.6505011803586
姫,-323.75815414648116
くん,-325.4864795549809
知ら,-330.17979135292273
森,-335.76505589585037
アリス,-337.8179204675667
青年,-341.8707609558579
我,-343.45132735482264
種族,-344.6544522276084
母,-346.6314035876618
モンスター,-349.29624177733035
悪魔,-350.88953690924524
狼,-355.24560383609025
説明,-361.59799036457696
教室,-379.64035335271933
精霊,-383.2252988186315
先生,-396.3429224634313
先輩,-406.0876690388384
異世界,-419.1954846321371
光,-450.75261743903917
僕,-497.0331694822289
オレ,-528.3516672465092
女神,-561.9701000457495
学校,-661.3131169362528
```
上位作品に引っ張られているだけなので固有名詞は無視して良いかと思います。  
上位も下位もいわゆるなろう的な単語が並んでいるのが興味深いです。    

何となくですが、いきなり神様が出てきたり異世界だと明言しちゃうようなメタ的導入はトレンドから外れており、
ギルドに入ったりパーティを組んだりして、ダンジョンに入ってスライムを倒す、みたいな古典的な導入が好まれているような気がします。  
女性向けでは相変わらず婚約破棄が強いですね。  
詳細は[こちら](https://raw.githubusercontent.com/tomboy-jp/Narou_Trend/master/result/coefficients.csv)からどうぞ。  
ではでは。
